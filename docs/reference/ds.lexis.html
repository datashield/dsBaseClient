<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Represents follow-up in multiple states on multiple time scales — ds.lexis • dsBaseClient</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Represents follow-up in multiple states on multiple time scales — ds.lexis"><meta property="og:description" content="This function takes a data frame containing survival data and expands it by converting records at
the level of individual subjects (survival time, censoring status, IDs and other variables) into
multiple records over a series of pre-defined time intervals."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsBaseClient</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">6.2.0-2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Represents follow-up in multiple states on multiple time scales</h1>
    
    <div class="hidden name"><code>ds.lexis.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function takes a data frame containing survival data and expands it by converting records at
the level of individual subjects (survival time, censoring status, IDs and other variables) into
multiple records over a series of pre-defined time intervals.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">ds.lexis</span><span class="op">(</span>
  data <span class="op">=</span> <span class="cn">NULL</span>,
  intervalWidth <span class="op">=</span> <span class="cn">NULL</span>,
  idCol <span class="op">=</span> <span class="cn">NULL</span>,
  entryCol <span class="op">=</span> <span class="cn">NULL</span>,
  exitCol <span class="op">=</span> <span class="cn">NULL</span>,
  statusCol <span class="op">=</span> <span class="cn">NULL</span>,
  variables <span class="op">=</span> <span class="cn">NULL</span>,
  expandDF <span class="op">=</span> <span class="cn">NULL</span>,
  datasources <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>a character string specifying the name of a data frame containing the
survival data to be expanded.</p></dd>
<dt>intervalWidth</dt>
<dd><p>a numeric vector specifying the length of each interval.
For more information see <strong>Details</strong>.</p></dd>
<dt>idCol</dt>
<dd><p>a character string denoting the column name that holds the individual IDs
of the subjects. For more information see <strong>Details</strong>.</p></dd>
<dt>entryCol</dt>
<dd><p>a character string denoting the column name that holds the entry times
(i.e. start of follow up). For more information see <strong>Details</strong>.</p></dd>
<dt>exitCol</dt>
<dd><p>a character string denoting the column name that holds the exit times
(i.e. end of follow up). For more information see <strong>Details</strong>.</p></dd>
<dt>statusCol</dt>
<dd><p>a character string denoting the column name that holds the
failure/censoring status of each subject. For more information see <strong>Details</strong>.</p></dd>
<dt>variables</dt>
<dd><p>a vector of character strings denoting the column names of additional
variables to include in the final expanded table. For more information see <strong>Details</strong>.</p></dd>
<dt>expandDF</dt>
<dd><p>a character string denoting the name of the new data frame containing the
expanded data set. Default <code>lexis.newobj</code>.</p></dd>
<dt>datasources</dt>
<dd><p>a list of <code><a href="https://datashield.github.io/DSI/reference/DSConnection-class.html" class="external-link">DSConnection-class</a></code> objects obtained after login. 
If the <code>datasources</code> argument is not specified 
the default set of connections will be used: see <code><a href="https://datashield.github.io/DSI/reference/datashield.connections_default.html" class="external-link">datashield.connections_default</a></code>.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p><code>ds.lexis</code> returns to the server-side a data frame for each study with 
the expanded version of the input table.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The function <code>ds.lexis</code> splits the survival interval time of subjects into pre-specified
sub-intervals that are each assumed to encompass a constant base-line hazard which means a
constant instantaneous risk of death). In the expanded dataset a row is included for every
interval in which a given individual is followed - regardless of how short or long that period may
be. Each row includes:<br>
(1) <strong>CENSOR</strong>: a variable indicating failure status for a particular
interval in that interval also known as censoring status. 
This variable can take two values: <strong>1</strong> representing that the patient
has died, relapsed or developed a
disease. <strong>0</strong> representing the lost-to-follow-up 
or passed right through the interval without failing. <br>
(2) <strong>SURVTIME</strong> an exposure-time variable indicating the duration of exposure-to-risk-of-failure
the corresponding individual experienced in that interval before he/she failed or was censored.</p>
<p>To illustrate, an individual who survives through 5 such intervals and then dies/fails in the
6th interval will be allocated a 0 value for the failure status/censoring variable in the first
five intervals and a 1 value in the 6th, while the exposure-time variable will be equal to the
total length of the relevant interval in each of the first five intervals, and the additional
length of time they survived in the sixth interval before they failed or were censored. If they
survive through the first interval and they are censored in the second interval, the
failure-status variable will take the value 0 in both intervals.<br>
(3) <strong>UID.expanded</strong> the expanded data set also
includes a unique ID in a form such as 77.13 which identifies that row of the
dataset as relating to the 77th individual in the input data set and his/her experience 
(exposure-time and failure status)in the
14th interval. Note that <code>.N</code> indicates the <code>(N+1)</code>th interval because 
interval 1 has no suffix.<br>
(4) <strong>IDSEQ</strong> the first part of <code>UID.expanded</code> (before the <code>'.'</code>). 
The value of this
variable is repeated in every row to which the corresponding individual contributes data (i.e.
to every row corresponding to an interval in which that individual was followed).<br>
(5) The expanded dataset contains any other variables about each individual that the user
would like to  carry forward to a survival analysis based on the expanded data. Typically,
this will include the original ID as specified to the data repository, the total survival time (equivalent to
the sum of the exposure times across all intervals) and the ultimate failure-status in the final
interval to which they were exposed.  The value of each of these variables is also repeated in
every row corresponding to an interval in which that individual was followed.</p>
<p>In <code>intervalWidth</code> argument if the total sum of the duration across all intervals is less 
than the maximum follow-up of any individual in
any contributing study, a final interval will be added by <code>ds.lexis</code> extending from the end of the
last interval specified to the maximum follow-up time. If a single numeric value is specified
rather than a vector, <code>ds.lexis</code> will keep adding intervals of the length specified until the
maximum follow-up time in any single study is exceeded. This argument is subject to
disclosure checks.</p>
<p>The <code>idCol</code> argument must be a numeric or character. Note that when a particular variable is
identified as being the main ID to the data repository when the data are first transferred 
to the data repository (i.e. before
DataSHIELD is used), that ID often ends up being of class character and will then be sorted in
alphabetic order (treating each digit as a character) rather than numeric. 
For example, containing the sequential IDs 1-1000, the order of the IDs will be:<br>
1,10,100,101,102,103,104,105,106,107,108,109,11 ...<br>
In an alphabetic listing: NOT to the expected order:<br>
1,2,3,4,5,6,7,8,9,10,11,12,13 ...<br></p>
<p>This alphabetic order or the ID listing will then carry forward to the
expanded dataset. But the nature and order of the original ID 
variable held in <code>idCol</code> doesn't
matter to <code>ds.lexis</code>. Provided every individual appears only once 
in the original data set (before expansion) the order does not matter because 
<code>ds.lexis</code> works on its unique numeric vector
that is allocated from <code>1:M</code> (where there are <code>M</code> individuals) 
in whatever order they appear in the original dataset.</p>
<p>in <code>entryCol</code> argument rather than using a total survival time variable to identify the
intervals to which any given individual is exposed, <code>ds.lexis</code> 
requires an initial entry time and a final exit time. If the data you wish to expand 
contain only a total survival time variable
and every individual starts follow-up at time 0, the entry times should all
be specified as zero, and the exit times as the total survival time. 
So, <code>entryCol</code> should either be the name of the column 
holding the entry time of each individual or else if no <code>entryCol</code> is
specified it will be defaulted to zero anyway and put into a variable 
called <code>starttime</code> in the expanded data set.</p>
<p>In <code>exitCol</code> argument, if the entry times (<code>entryCol</code>) are set, 
or defaulted, to zero, the <code>exitCol</code> variable should contain the total survival times.</p>
<p>If <code>variables</code> argument is not set (is
null) but the <code>data</code> argument is set, the expanded data 
set will contain all variables in the data frame identified by the <code>data</code> argument. 
If neither the <code>data</code> or 
<code>variables</code> arguments are set, the expanded data set will only include the ID, 
exposure time and failure/censoring status
variables which may still be useful for plotting survival data once these become available.</p>
<p>This function is particularly meant to be used in preparing data for a piecewise
regression analysis (PAR). Although the time intervals have to be pre-specified and are
arbitrary, even a vaguely reasonable set of time intervals will give results very similar to a
Cox regression analysis. The key issue is to choose survival intervals such that the baseline
hazard (risk of death/disease/failure) within each interval is reasonably constant while the
baseline hazard can vary freely between intervals. Even if the choice of intervals is very poor
the ultimate results are typically qualitatively similar to Cox regression. Increasing the
number of intervals will inevitably improve the approximation to the true baseline hazard, but
the addition of many more unnecessary time intervals slows the analysis and can become disclosive
and yet will not improve the fit of the model.</p>
<p>If the number of failures in one or more 
periods in a given study is less than the specified disclosure filter determining minimum
acceptable cell size in a table (<code>nfilter.tab</code>) 
then the expanded data frame is not created in that study, and a study-side message 
to this effect is made available in that study via <code><a href="ds.message.html">ds.message()</a></code> function.</p>

<p>Server functions called: <code>lexisDS1</code>, <code>lexisDS2</code> and <code>lexisDS3</code></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="ds.glm.html">ds.glm</a></code> for generalized linear models.</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>DataSHIELD Development Team</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"></span>
<span class="r-in"> <span class="co">## Version 6, for version 5 see Wiki</span></span>
<span class="r-in">  <span class="co"># Connecting to the Opal servers</span></span>
<span class="r-in">  </span>
<span class="r-in">  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/datashield/DSI/" class="external-link">'DSI'</a></span><span class="op">)</span></span>
<span class="r-in">  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/datashield/DSOpal/" class="external-link">'DSOpal'</a></span><span class="op">)</span></span>
<span class="r-in">  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">'dsBaseClient'</span><span class="op">)</span></span>
<span class="r-in">  </span>
<span class="r-in">  <span class="co"># Example 1: Fitting GLM for survival analysis</span></span>
<span class="r-in">  <span class="co"># For this analysis we need to load survival data from the server </span></span>
<span class="r-in">  </span>
<span class="r-in">  <span class="va">builder</span> <span class="op">&lt;-</span> <span class="fu">DSI</span><span class="fu">::</span><span class="fu"><a href="https://datashield.github.io/DSI/reference/newDSLoginBuilder.html" class="external-link">newDSLoginBuilder</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"study1"</span>, </span>
<span class="r-in">                 url <span class="op">=</span> <span class="st">"http://192.168.56.100:8080/"</span>, </span>
<span class="r-in">                 user <span class="op">=</span> <span class="st">"administrator"</span>, password <span class="op">=</span> <span class="st">"datashield_test&amp;"</span>, </span>
<span class="r-in">                 table <span class="op">=</span> <span class="st">"SURVIVAL.EXPAND_NO_MISSING1"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"study2"</span>, </span>
<span class="r-in">                 url <span class="op">=</span> <span class="st">"http://192.168.56.100:8080/"</span>, </span>
<span class="r-in">                 user <span class="op">=</span> <span class="st">"administrator"</span>, password <span class="op">=</span> <span class="st">"datashield_test&amp;"</span>, </span>
<span class="r-in">                 table <span class="op">=</span> <span class="st">"SURVIVAL.EXPAND_NO_MISSING2"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"study3"</span>,</span>
<span class="r-in">                 url <span class="op">=</span> <span class="st">"http://192.168.56.100:8080/"</span>, </span>
<span class="r-in">                 user <span class="op">=</span> <span class="st">"administrator"</span>, password <span class="op">=</span> <span class="st">"datashield_test&amp;"</span>, </span>
<span class="r-in">                 table <span class="op">=</span> <span class="st">"SURVIVAL.EXPAND_NO_MISSING3"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">logindata</span> <span class="op">&lt;-</span> <span class="va">builder</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in">  </span>
<span class="r-in">  <span class="co"># Log onto the remote Opal training servers</span></span>
<span class="r-in">  <span class="va">connections</span> <span class="op">&lt;-</span> <span class="fu">DSI</span><span class="fu">::</span><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.login.html" class="external-link">datashield.login</a></span><span class="op">(</span>logins <span class="op">=</span> <span class="va">logindata</span>, assign <span class="op">=</span> <span class="cn">TRUE</span>, symbol <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> </span>
<span class="r-in">  </span>
<span class="r-in">  <span class="co">#Example 1: Create the expanded data frame. </span></span>
<span class="r-in">  <span class="co">#The survival time intervals are to be 0&lt;t&lt;=2.5; 2.5&lt;t&lt;=5.0, 5.0&lt;t&lt;=7.5, </span></span>
<span class="r-in">  <span class="co">#up to the final interval of duration 2.5</span></span>
<span class="r-in">  <span class="co">#that includes the maximum survival time. </span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="fu">ds.lexis</span><span class="op">(</span>data <span class="op">=</span> <span class="st">"D"</span>, </span>
<span class="r-in">           intervalWidth <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span class="r-in">           idCol <span class="op">=</span> <span class="st">"D$id"</span>,</span>
<span class="r-in">           entryCol <span class="op">=</span> <span class="st">"D$starttime"</span>,</span>
<span class="r-in">           exitCol <span class="op">=</span> <span class="st">"D$endtime"</span>,</span>
<span class="r-in">           statusCol <span class="op">=</span> <span class="st">"D$cens"</span>,</span>
<span class="r-in">           expandDF <span class="op">=</span> <span class="st">"EM.new"</span>,</span>
<span class="r-in">           datasources <span class="op">=</span> <span class="va">connections</span><span class="op">)</span></span>
<span class="r-in">           </span>
<span class="r-in">  <span class="co">#Confirm that the expanded data frame has been ceated</span></span>
<span class="r-in">  <span class="fu"><a href="ds.ls.html">ds.ls</a></span><span class="op">(</span>datasources <span class="op">=</span> <span class="va">connections</span><span class="op">)</span> </span>
<span class="r-in">  <span class="co">#Example 2: Create the expanded data frame. </span></span>
<span class="r-in">  <span class="co">#The survival time intervals are to be 0&lt;t&lt;=1; 1&lt;t&lt;=2.0, 2.0&lt;t&lt;=5.0, 5.0&lt;t&lt;=11.0,</span></span>
<span class="r-in">  </span>
<span class="r-in">  <span class="fu">ds.lexis</span><span class="op">(</span>data <span class="op">=</span> <span class="st">"D"</span>,</span>
<span class="r-in">           intervalWidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span>, </span>
<span class="r-in">           idCol <span class="op">=</span> <span class="st">"D$id"</span>,</span>
<span class="r-in">           entryCol <span class="op">=</span> <span class="st">"D$starttime"</span>, </span>
<span class="r-in">           exitCol <span class="op">=</span> <span class="st">"D$endtime"</span>, </span>
<span class="r-in">           statusCol <span class="op">=</span> <span class="st">"D$cens"</span>,</span>
<span class="r-in">           expandDF <span class="op">=</span> <span class="st">"EM.new2"</span>,</span>
<span class="r-in">           datasources <span class="op">=</span> <span class="va">connections</span><span class="op">)</span></span>
<span class="r-in">           </span>
<span class="r-in">  <span class="co">#Confirm expanded dataframe created</span></span>
<span class="r-in">  <span class="fu"><a href="ds.ls.html">ds.ls</a></span><span class="op">(</span>datasources <span class="op">=</span> <span class="va">connections</span><span class="op">)</span> </span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by DataSHIELD Developers.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

