<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Converts a server-side numeric vector into a factor — ds.asFactor • dsBaseClient</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Converts a server-side numeric vector into a factor — ds.asFactor"><meta property="og:description" content="This function assigns a server-side numeric vector into a factor class."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsBaseClient</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">6.2.0-2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Converts a server-side numeric vector into a factor</h1>
    
    <div class="hidden name"><code>ds.asFactor.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function assigns a server-side numeric vector into a factor class.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">ds.asFactor</span><span class="op">(</span>
  input.var.name <span class="op">=</span> <span class="cn">NULL</span>,
  newobj.name <span class="op">=</span> <span class="cn">NULL</span>,
  forced.factor.levels <span class="op">=</span> <span class="cn">NULL</span>,
  fixed.dummy.vars <span class="op">=</span> <span class="cn">FALSE</span>,
  baseline.level <span class="op">=</span> <span class="fl">1</span>,
  datasources <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>input.var.name</dt>
<dd><p>a character string which provides 
the name of the variable to be converted to a factor.</p></dd>
<dt>newobj.name</dt>
<dd><p>a character string that provides the name for the output variable 
that is stored on the data servers. Default <code>asfactor.newobj</code>.</p></dd>
<dt>forced.factor.levels</dt>
<dd><p>the levels that the user wants to split the input variable. 
If NULL (default) a vector with all unique levels from all studies are created.</p></dd>
<dt>fixed.dummy.vars</dt>
<dd><p>boolean. If TRUE the input variable is converted to a factor 
but presented as a matrix of dummy variables. 
If FALSE (default) the input variable
is converted to a factor and assigned as a vector.</p></dd>
<dt>baseline.level</dt>
<dd><p>an integer indicating the baseline level 
to be used in the creation of the matrix with dummy variables. 
If the <code>fixed.dummy.vars</code> is set to FALSE then any value of the baseline level is not taken
into account.</p></dd>
<dt>datasources</dt>
<dd><p>a list of <code><a href="https://datashield.github.io/DSI/reference/DSConnection-class.html" class="external-link">DSConnection-class</a></code> objects obtained after login. 
If the <code>datasources</code> argument is not specified
the default set of connections will be used: see <code><a href="https://datashield.github.io/DSI/reference/datashield.connections_default.html" class="external-link">datashield.connections_default</a></code>.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p><code>ds.asFactor</code> returns the unique levels of the converted 
variable in ascending order and a validity 
message with the name of the created object on the client-side and 
the output matrix or vector in the server-side.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Converts a numeric vector into a factor type which is represented either as a vector
or as a matrix of dummy variables depending on the argument <code>fixed.dummy.vars</code>.
The matrix of dummy variables also depends on the argument
<code>baseline.level</code>.</p>
<p>ds.asFactor.R and its associated serverside functions asFactorDS1 and asFactorDS2
are to be used when you have variable that has up to 40 unique levels across
all sources combined. If one of the sources does not contain any subjects at a
particular level, that level will still be created as an empty category. In the
end all sources thus include a factor variable with consistent factor levels
across all sources - one level for every unique value that occurs in at least one
source. This is important when you wish to fit models using ds.glm because the factor
levels must be consistent across all studies or the model will not fit.</p>
<p>But in order for this to be possible, all sources have to share all of the unique values
their source holds for the variable. This allows the client to create a single vector
containing all of the unique factor levels across ALL sources. But this is potentially
disclosive if there are too many levels. There are therefore two checks on the number of
levels in each source. One is simply a test of whether the number of levels exceeds
a value specified by the Roption value 'nfilter.max.levels' which is set by default
to 40, but the data custodian for the source can choose any alternative value he/she
chooses. The second test is of whether the levels are too dense: ie do the number of
levels exceed a specified proportion of the full length of the relevant vector
in the particular source. The max density is set by the Roption value 'nfilter.levels'
which takes the default value 0.33 but can again be modified by the data custodian.</p>
<p>In combination, these two checks mean that if a factor has 35 levels in a given study
where the total length of the variable to be converted to a factor is 1000 individuals,
the ds.asFactor function will process that variable appropriately. But if it had had
45 levels it would have been blocked by 'nfilter.max.levels' and if the total length of
the variable in that study had only been 70 subjects it would have been blocked by
the density criterion held in 'nfilter.levels'.</p>
<p>If you have a factor with more than 40 levels in each source - perhaps most commonly
an ID of some sort that you need to provide as an argument to eg a tapply function.
Then you cannot use ds.asFactor. Typically in these circumstance you simply want
to create a factor that is appropriate for each source but you do not need to ensure
that all levels are consistent across all sources. In that case, you can use the
ds.asFactorSimple function which does no more than coerce a numeric or character
variable to a factor. Because you do not need to share unique factor levels
between sources, there is then no disclosure issue.</p>
<p>To understand how the matrix of the dummy variable is created let's assume that we have the vector
<code>(1, 2, 1, 3, 4, 4, 1, 3, 4, 5)</code> of ten integer numbers. 
If we set the argument <code>fixed.dummy.vars = TRUE</code>,
<code>baseline.level = 1</code> and <code>forced.factor.levels = c(1,2,3,4,5)</code>. 
The input vector is converted to the following matrix of dummy variables:</p>
<table class="table table"><tr><td><strong>DV2</strong></td><td><strong>DV3</strong></td><td><strong>DV4</strong></td><td><strong>DV5</strong></td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr></table><p>For the same example if the <code>baseline.level = 3</code> then the matrix is:</p>
<p></p><table class="table table"><tr><td><strong>DV1</strong></td><td><strong>DV2</strong></td><td><strong>DV4</strong></td><td><strong>DV5</strong></td></tr><tr><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td></tr></table><p>In the first instance the first row of the matrix has zeros in all entries indicating 
that the first data point belongs to level 1 (as the baseline level is equal to 1). 
The second row has 1 at the first (<code>DV2</code>) column and zeros elsewhere,
indicating that the second data point belongs to level 2. 
In the second instance (second matrix) where the baseline level is equal to 3, 
the first row of the matrix has 1 at the
first (<code>DV1</code>) column and zeros elsewhere, 
indicating again that the first data point belongs to level 1.
Also as we can see the fourth row of the second matrix has all its elements equal 
to zero indicating that the
fourth data point belongs to level 3 (as the baseline level, in that case, is 3).</p>
<p>If the <code>baseline.level</code> is set to be equal to a value 
that is not one of the levels of the factor then a
matrix of dummy variables is created having as many columns as the number of levels.
In that case in each row there is a unique entry equal to 1 at a 
certain column indicating the level of each data point. So, for the
above example where the vector has five levels
if we set the <code>baseline.level</code> equal to a value that does not
belong to those five levels (<code>baseline.level=8</code>) 
the matrix of dummy variables is:</p>
<table class="table table"><tr><td><strong>DV1</strong></td><td><strong>DV2</strong></td><td><strong>DV3</strong></td><td><strong>DV4</strong></td><td><strong>DV5</strong></td></tr><tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr></table><p>Server functions called: <code>asFactorDS1</code> and <code>asFactorDS2</code></p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>DataSHIELD Development Team</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co">## Version 6, for version 5 see Wiki</span></span>
<span class="r-in">  <span class="co"># Connecting to the Opal servers</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/datashield/DSI/" class="external-link">'DSI'</a></span><span class="op">)</span></span>
<span class="r-in">  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/datashield/DSOpal/" class="external-link">'DSOpal'</a></span><span class="op">)</span></span>
<span class="r-in">  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">'dsBaseClient'</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="va">builder</span> <span class="op">&lt;-</span> <span class="fu">DSI</span><span class="fu">::</span><span class="fu"><a href="https://datashield.github.io/DSI/reference/newDSLoginBuilder.html" class="external-link">newDSLoginBuilder</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"study1"</span>, </span>
<span class="r-in">                 url <span class="op">=</span> <span class="st">"http://192.168.56.100:8080/"</span>, </span>
<span class="r-in">                 user <span class="op">=</span> <span class="st">"administrator"</span>, password <span class="op">=</span> <span class="st">"datashield_test&amp;"</span>, </span>
<span class="r-in">                 table <span class="op">=</span> <span class="st">"CNSIM.CNSIM1"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"study2"</span>, </span>
<span class="r-in">                 url <span class="op">=</span> <span class="st">"http://192.168.56.100:8080/"</span>, </span>
<span class="r-in">                 user <span class="op">=</span> <span class="st">"administrator"</span>, password <span class="op">=</span> <span class="st">"datashield_test&amp;"</span>, </span>
<span class="r-in">                 table <span class="op">=</span> <span class="st">"CNSIM.CNSIM2"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"study3"</span>,</span>
<span class="r-in">                 url <span class="op">=</span> <span class="st">"http://192.168.56.100:8080/"</span>, </span>
<span class="r-in">                 user <span class="op">=</span> <span class="st">"administrator"</span>, password <span class="op">=</span> <span class="st">"datashield_test&amp;"</span>, </span>
<span class="r-in">                 table <span class="op">=</span> <span class="st">"CNSIM.CNSIM3"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">logindata</span> <span class="op">&lt;-</span> <span class="va">builder</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># Log onto the remote Opal training servers</span></span>
<span class="r-in">  <span class="va">connections</span> <span class="op">&lt;-</span> <span class="fu">DSI</span><span class="fu">::</span><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.login.html" class="external-link">datashield.login</a></span><span class="op">(</span>logins <span class="op">=</span> <span class="va">logindata</span>, assign <span class="op">=</span> <span class="cn">TRUE</span>, symbol <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> </span>
<span class="r-in"></span>
<span class="r-in">  <span class="fu">ds.asFactor</span><span class="op">(</span>input.var.name <span class="op">=</span> <span class="st">"D$PM_BMI_CATEGORICAL"</span>, </span>
<span class="r-in">              newobj.name <span class="op">=</span> <span class="st">"fact.obj"</span>, </span>
<span class="r-in">              forced.factor.levels <span class="op">=</span> <span class="cn">NULL</span>, <span class="co">#a vector with all unique levels </span></span>
<span class="r-in">                                           <span class="co">#from all studies is created</span></span>
<span class="r-in">              fixed.dummy.vars <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">#create a matrix of dummy variables</span></span>
<span class="r-in">              baseline.level <span class="op">=</span> <span class="fl">1</span>,</span>
<span class="r-in">              datasources <span class="op">=</span> <span class="va">connections</span><span class="op">)</span><span class="co">#all the Opal servers are used, in this case 3 </span></span>
<span class="r-in">                                        <span class="co">#(see above the connection to the servers) </span></span>
<span class="r-in">  <span class="fu">ds.asFactor</span><span class="op">(</span>input.var.name <span class="op">=</span> <span class="st">"D$PM_BMI_CATEGORICAL"</span>, </span>
<span class="r-in">              newobj.name <span class="op">=</span> <span class="st">"fact.obj"</span>, </span>
<span class="r-in">              forced.factor.levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, <span class="co">#the variable is split in 2 levels</span></span>
<span class="r-in">              fixed.dummy.vars <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">#create a matrix of dummy variables</span></span>
<span class="r-in">              baseline.level <span class="op">=</span> <span class="fl">1</span>,</span>
<span class="r-in">              datasources <span class="op">=</span> <span class="va">connections</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="co">#only the first Opal server is used ("study1")</span></span>
<span class="r-in"></span>
<span class="r-in">   <span class="co"># Clear the Datashield R sessions and logout  </span></span>
<span class="r-in">   <span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.logout.html" class="external-link">datashield.logout</a></span><span class="op">(</span><span class="va">connections</span><span class="op">)</span> </span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by DataSHIELD Developers.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

