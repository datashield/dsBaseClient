language: generic
sudo: required
dist: trusty
before_install:
    - wget -nv https://apt.puppetlabs.com/puppetlabs-release-pc1-trusty.deb
    - sudo dpkg -i puppetlabs-release-pc1-trusty.deb
    - sudo rm -f puppetlabs-release-pc1-trusty.deb
    - sudo apt-get update -qq
    - sudo apt-get install -qq puppet-agent -y
    - sudo apt-get install -qq git -y
    - sudo /opt/puppetlabs/puppet/bin/gem install r10k
    - git clone https://github.com/nparley/datashield.git /tmp/datashield
    - cd /tmp/datashield/puppet/environments/travis && sudo /opt/puppetlabs/puppet/bin/r10k puppetfile install && cd -
    - sudo /opt/puppetlabs/bin/puppet apply /tmp/datashield/puppet/environments/travis/manifests/site.pp --environment travis --environmentpath /tmp/datashield/puppet/environments

# Github packages
#r_github_packages:
# - datashield/opal

script:
  - sudo cat /var/log/opal/stdout.log
  - sudo lsof -i
  - sudo iptables -L
  - sudo iptables -S
  - curl 127.0.0.1:8080
  - curl localhost:8080
  - curl https://localhost:8443 --insecure
  - sudo R -e "library(devtools); build(); install();"
#  - cd inst/tests && R -q -f runRunitTests.R


